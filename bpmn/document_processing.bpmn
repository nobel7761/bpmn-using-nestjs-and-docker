<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://flowable.org/test">
  <collaboration id="Collaboration">
    <participant id="sid-26F44DAA-2CBB-4249-A16B-D3E3B733FFF4" name="Document Process" processRef="process"></participant>
  </collaboration>
  <process id="process" name="Document Process" isExecutable="true">
    <laneSet id="laneSet_process">
      <lane id="sid-079B0A04-3122-4224-985F-7FAB177C8188" name="User">
        <flowNodeRef>startEvent</flowNodeRef>
        <flowNodeRef>sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327</flowNodeRef>
        <flowNodeRef>manualApprovalTask</flowNodeRef>
        <flowNodeRef>sid-14E0347B-949A-44F3-BBB5-B95FF2055DFD</flowNodeRef>
        <flowNodeRef>sid-EE410C19-48E9-47AC-AB81-CE507E4E33A6</flowNodeRef>
      </lane>
      <lane id="sid-D63E3C45-FD17-4728-94B1-217CFAB54397" name="Automated Process">
        <flowNodeRef>validateTask</flowNodeRef>
        <flowNodeRef>amountGateway</flowNodeRef>
        <flowNodeRef>autoApproveTask</flowNodeRef>
        <flowNodeRef>mergeGateway</flowNodeRef>
        <flowNodeRef>endEvent</flowNodeRef>
      </lane>
    </laneSet>
    <startEvent id="startEvent" name="Start" flowable:formFieldValidation="true"></startEvent>
    <userTask id="sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327" name="Upload Document" flowable:assignee="admin" flowable:formFieldValidation="true">
      <extensionElements>
        <modeler:initiator-can-complete xmlns:modeler="http://flowable.org/modeler"><![CDATA[false]]></modeler:initiator-can-complete>
      </extensionElements>
    </userTask>
    <userTask id="manualApprovalTask" name="Manual Approval Required" flowable:assignee="admin" flowable:formFieldValidation="true">
      <extensionElements>
        <modeler:initiator-can-complete xmlns:modeler="http://flowable.org/modeler"><![CDATA[false]]></modeler:initiator-can-complete>
      </extensionElements>
    </userTask>
    <scriptTask id="validateTask" name="Validate Document" scriptFormat="javascript" flowable:autoStoreVariables="false">
      <script><![CDATA[
        // Validate that process was started by API with required variables
        var documentId = execution.getVariable("documentId");
        var filePath = execution.getVariable("filePath");
        var amount = execution.getVariable("amount");
        
        if (!documentId || !filePath || amount === null || amount === undefined) {
          throw new Error("Process must be started via API with document upload. Missing required variables: documentId, filePath, amount");
        }
        
        // Additional validation
        if (typeof amount !== "number" || amount < 0) {
          throw new Error("Invalid amount value. Must be a positive number.");
        }
        
        execution.setVariable("validated", true);
      ]]></script>
    </scriptTask>
    <exclusiveGateway id="amountGateway" name="Amount Check"></exclusiveGateway>
    <scriptTask id="autoApproveTask" name="Auto Approve" scriptFormat="javascript" flowable:autoStoreVariables="false">
      <script><![CDATA[
        execution.setVariable("approved", true);
        execution.setVariable("approvalType", "automatic");
      ]]></script>
    </scriptTask>
    <exclusiveGateway id="mergeGateway"></exclusiveGateway>
    <endEvent id="endEvent" name="End"></endEvent>
    <sequenceFlow id="flowHigh" sourceRef="amountGateway" targetRef="manualApprovalTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${amount >= 1000}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow3" sourceRef="manualApprovalTask" targetRef="mergeGateway"></sequenceFlow>
    <sequenceFlow id="flow2" sourceRef="validateTask" targetRef="amountGateway"></sequenceFlow>
    <sequenceFlow id="flowLow" sourceRef="amountGateway" targetRef="autoApproveTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${amount < 1000}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow5" sourceRef="mergeGateway" targetRef="endEvent"></sequenceFlow>
    <sequenceFlow id="flow4" sourceRef="autoApproveTask" targetRef="mergeGateway"></sequenceFlow>
    <sequenceFlow id="sid-14E0347B-949A-44F3-BBB5-B95FF2055DFD" sourceRef="sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327" targetRef="validateTask"></sequenceFlow>
    <sequenceFlow id="sid-EE410C19-48E9-47AC-AB81-CE507E4E33A6" sourceRef="startEvent" targetRef="sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_Collaboration">
    <bpmndi:BPMNPlane bpmnElement="Collaboration" id="BPMNPlane_Collaboration">
      <bpmndi:BPMNShape bpmnElement="sid-26F44DAA-2CBB-4249-A16B-D3E3B733FFF4" id="BPMNShape_sid-26F44DAA-2CBB-4249-A16B-D3E3B733FFF4">
        <omgdc:Bounds height="458.00000089009603" width="851.6666079485883" x="179.99998855590914" y="89.99999809265152"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-079B0A04-3122-4224-985F-7FAB177C8188" id="BPMNShape_sid-079B0A04-3122-4224-985F-7FAB177C8188">
        <omgdc:Bounds height="208.0000008900961" width="821.6666079485883" x="209.99998855590914" y="89.99999809265152"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="startEvent" id="BPMNShape_startEvent">
        <omgdc:Bounds height="29.999999999999986" width="30.0" x="269.99999427795456" y="180.24999148051"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327" id="BPMNShape_sid-A8F4E4CA-2BE0-464D-BCD1-6D5C0C841327">
        <omgdc:Bounds height="60.00000000000007" width="99.99999999999991" x="366.6666016048907" y="163.9999950620868"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="manualApprovalTask" id="BPMNShape_manualApprovalTask">
        <omgdc:Bounds height="60.00000000000007" width="99.99999999999991" x="646.8332630581392" y="163.9999915864741"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-D63E3C45-FD17-4728-94B1-217CFAB54397" id="BPMNShape_sid-D63E3C45-FD17-4728-94B1-217CFAB54397">
        <omgdc:Bounds height="249.99999999999994" width="821.6666079485883" x="209.99998855590914" y="297.9999989827476"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="validateTask" id="BPMNShape_validateTask">
        <omgdc:Bounds height="60.0" width="99.99999999999997" x="366.6666093755684" y="350.49998778237347"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="amountGateway" id="BPMNShape_amountGateway">
        <omgdc:Bounds height="40.0" width="39.99999999999997" x="539.9999917348233" y="360.49999521043605"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="autoApproveTask" id="BPMNShape_autoApproveTask">
        <omgdc:Bounds height="60.0" width="99.99999999999997" x="609.999985376995" y="435.49998789893357"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="mergeGateway" id="BPMNShape_mergeGateway">
        <omgdc:Bounds height="40.0" width="40.00000000000003" x="779.9999917348232" y="360.49999521043605"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endEvent" id="BPMNShape_endEvent">
        <omgdc:Bounds height="28.0" width="28.00000000000003" x="869.9999917348232" y="365.49999521043605"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flowHigh" id="BPMNEdge_flowHigh">
        <omgdi:waypoint x="559.9999917348233" y="360.49999521043605"></omgdi:waypoint>
        <omgdi:waypoint x="559.9999917348233" y="193.99999158647412"></omgdi:waypoint>
        <omgdi:waypoint x="646.8332630581352" y="193.99999158647412"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="466.61660849967205" y="380.499990370966"></omgdi:waypoint>
        <omgdi:waypoint x="539.9999917348233" y="380.4999941739626"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="746.783263058139" y="193.99999158647412"></omgdi:waypoint>
        <omgdi:waypoint x="799.9999917348232" y="193.99999158647412"></omgdi:waypoint>
        <omgdi:waypoint x="799.9999917348232" y="360.49999521043605"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="709.9499853769913" y="465.23053329109877"></omgdi:waypoint>
        <omgdi:waypoint x="799.166703100555" y="464.7500056319763"></omgdi:waypoint>
        <omgdi:waypoint x="799.8041157771404" y="400.2546089426475"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
        <omgdi:waypoint x="819.7152858524666" y="380.264701092789"></omgdi:waypoint>
        <omgdi:waypoint x="870.000960897315" y="379.666055268223"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-14E0347B-949A-44F3-BBB5-B95FF2055DFD" id="BPMNEdge_sid-14E0347B-949A-44F3-BBB5-B95FF2055DFD">
        <omgdi:waypoint x="416.6666028527824" y="223.94999506208688"></omgdi:waypoint>
        <omgdi:waypoint x="416.66660812559337" y="350.49998778237347"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-EE410C19-48E9-47AC-AB81-CE507E4E33A6" id="BPMNEdge_sid-EE410C19-48E9-47AC-AB81-CE507E4E33A6">
        <omgdi:waypoint x="299.9499926721053" y="195.24999148051"></omgdi:waypoint>
        <omgdi:waypoint x="366.6666016048907" y="195.24999148051"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flowLow" id="BPMNEdge_flowLow">
        <omgdi:waypoint x="559.8041157771405" y="400.2546089426475"></omgdi:waypoint>
        <omgdi:waypoint x="559.166703100555" y="464.7500056319763"></omgdi:waypoint>
        <omgdi:waypoint x="609.9999853769895" y="465.12809567742426"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>

